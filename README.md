# EPUB 画像バリケーター (EPUB Image Validator)

指定されたフォルダ内の EPUB ファイルをスキャンし、画像ファイルが指定されているのに EPUB 内に存在しない「破損した」ファイルを見つけ出し、必要に応じて隔離するツールです。

## 主な機能

- **画像参照の検証**: EPUB 内の全 HTML/XHTML ファイルを解析し、`<img>` タグや `<image>` タグで参照されている画像が、実際にアーカイブ内に存在するかをチェックします。
- **破損ファイルの隔離**: `--isolate` オプションを使用すると、破損した EPUB ファイルを自動的に `broken` フォルダへ移動します。
- **詳細なレポート**: どの EPUB のどのファイルで、どの画像パスが欠落しているかをコンソールに出力します。

## 必要条件

- Python 3.10 以上
- [uv](https://github.com/astral-sh/uv) (パッケージ管理および実行用)

## セットアップ

このプロジェクトは `uv` を使用して管理されています。以下の手順で準備が完了します。

1. このリポジトリをダウンロードします。
2. 依存関係のインストール（オプション。`uv run` 時に自動で行われます）:
   ```bash
   uv sync
   ```

## 使い方

`uv run` を使用して実行します。スキャンしたい EPUB が入っているフォルダを引数に指定してください。

### 基本的なチェック（表示のみ）
フォルダ内のファイルを検証し、結果をレポートします。ファイルは移動されません。

```bash
uv run main.py /path/to/your/epub/folder
```

### チェックと隔離（フォルダ移動あり）
破損したファイルを、そのフォルダ内の `broken` サブフォルダへ移動します。

```bash
uv run main.py /path/to/your/epub/folder --isolate
```

## 仕組み

1. 指定されたフォルダ内のすべての `.epub` ファイルを走査します。
2. 各 EPUB を ZIP アーカイブとして読み込みます。
3. アーカイブ内の `.html` または `.xhtml` ファイルを `BeautifulSoup` と `lxml` でパースします。
4. 画像タグ（`src` や `href`）を見つけ、相対パスを解決します。
5. 解決されたパスがアーカイブ内に存在するかを確認します。
6. 1つでも画像が欠落している場合、そのファイルは「破損」とみなされます。